# ApexBlog 后台管理接口文档

## 基本信息

- **基础URL**: `http://localhost:8888/api`
- **API版本**: v1.0
- **数据格式**: JSON
- **字符编码**: UTF-8
- **认证方式**: JWT Bearer Token（所有接口都需要认证）

## 通用响应格式

所有接口都使用统一的响应格式：

```json
{
  "code": 200,
  "message": "操作成功",
  "data": {},
  "timestamp": 1691740800000
}
```

### 响应状态码

| 状态码 | 说明 |
|--------|------|
| 200 | 请求成功 |
| 400 | 请求参数错误 |
| 401 | 未授权，需要登录 |
| 403 | 禁止访问，权限不足 |
| 404 | 资源不存在 |
| 500 | 服务器内部错误 |

## 认证说明

### 登录接口

**接口**: `POST /auth/login`

**请求参数**:
```json
{
  "username": "xuyi",
  "password": "5247xff"
}
```

**响应数据**:
```json
{
  "code": 200,
  "message": "登录成功",
  "data": {
    "token": "eyJhbGciOiJIUzM4NCJ9...",
    "tokenType": "Bearer",
    "user": {
      "id": 1,
      "username": "xuyi",
      "email": "xuyi@example.com",
      "nickname": "Xuyi",
      "bio": "全栈开发工程师，专注于Java和前端技术"
    }
  },
  "timestamp": 1754978026357
}
```

**说明**:
- 登录接口不需要认证
- 成功登录后获得JWT token，有效期24小时
- 需要保存token用于后续API调用

### Token使用

所有管理后台接口都需要在请求头中携带JWT token：

```
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

## 分页响应格式

分页接口的 `data` 字段格式：

```json
{
  "content": [],
  "page": 0,
  "size": 10,
  "totalElements": 100,
  "totalPages": 10,
  "first": true,
  "last": false,
  "hasNext": true,
  "hasPrevious": false
}
```

## 文章管理

### 获取所有文章（包括草稿）

**接口**: `GET /admin/articles`

**请求头**: `Authorization: Bearer {token}`

**请求参数**:
- `page` (int, 可选): 页码，默认0
- `size` (int, 可选): 每页大小，默认10

**响应数据**: 分页的文章摘要列表（包括草稿状态的文章）

### 获取文章详情

**接口**: `GET /admin/articles/{id}`

**请求头**: `Authorization: Bearer {token}`

**路径参数**:
- `id` (long): 文章ID

**响应数据**: 完整的文章对象

### 创建文章

**接口**: `POST /admin/articles`

**请求头**: `Authorization: Bearer {token}`

**请求参数**:
```json
{
  "title": "文章标题",
  "summary": "文章摘要",
  "content": "文章内容（Markdown格式）",
  "coverImage": "http://example.com/cover.jpg",
  "categoryId": 1,
  "status": "DRAFT",
  "isTop": false,
  "tagNames": ["Java", "Spring Boot"]
}
```

**字段说明**:
- `title`: 文章标题（必需，最大200字符）
- `summary`: 文章摘要（可选）
- `content`: 文章内容（必需，支持Markdown）
- `coverImage`: 封面图片URL（可选）
- `categoryId`: 分类ID（可选）
- `status`: 文章状态，可选值：`DRAFT`（草稿）、`PUBLISHED`（已发布）
- `isTop`: 是否置顶（可选，默认false）
- `tagNames`: 标签名称数组（可选）

**响应数据**: 创建的文章对象

### 更新文章

**接口**: `PUT /admin/articles/{id}`

**请求头**: `Authorization: Bearer {token}`

**路径参数**:
- `id` (long): 文章ID

**请求参数**: 同创建文章

**响应数据**: 更新后的文章对象

### 删除文章

**接口**: `DELETE /admin/articles/{id}`

**请求头**: `Authorization: Bearer {token}`

**路径参数**:
- `id` (long): 文章ID

**响应数据**: 无

### 发布文章

**接口**: `PUT /admin/articles/{id}/publish`

**请求头**: `Authorization: Bearer {token}`

**路径参数**:
- `id` (long): 文章ID

**响应数据**: 更新后的文章对象

### 取消发布文章

**接口**: `PUT /admin/articles/{id}/unpublish`

**请求头**: `Authorization: Bearer {token}`

**路径参数**:
- `id` (long): 文章ID

**响应数据**: 更新后的文章对象

## 分类管理

### 获取所有分类

**接口**: `GET /admin/categories`

**请求头**: `Authorization: Bearer {token}`

**响应数据**: 分类列表

### 获取分类详情

**接口**: `GET /admin/categories/{id}`

**请求头**: `Authorization: Bearer {token}`

**路径参数**:
- `id` (long): 分类ID

**响应数据**: 分类对象

### 创建分类

**接口**: `POST /admin/categories`

**请求头**: `Authorization: Bearer {token}`

**请求参数**:
```json
{
  "name": "分类名称",
  "description": "分类描述",
  "sortOrder": 1
}
```

**字段说明**:
- `name`: 分类名称（必需，最大50字符）
- `description`: 分类描述（可选）
- `sortOrder`: 排序顺序（可选，默认0）

**响应数据**: 创建的分类对象

### 更新分类

**接口**: `PUT /admin/categories/{id}`

**请求头**: `Authorization: Bearer {token}`

**路径参数**:
- `id` (long): 分类ID

**请求参数**: 同创建分类

**响应数据**: 更新后的分类对象

### 删除分类

**接口**: `DELETE /admin/categories/{id}`

**请求头**: `Authorization: Bearer {token}`

**路径参数**:
- `id` (long): 分类ID

**响应数据**: 无

## 标签管理

### 获取所有标签

**接口**: `GET /admin/tags`

**请求头**: `Authorization: Bearer {token}`

**响应数据**: 标签列表

### 获取标签详情

**接口**: `GET /admin/tags/{id}`

**请求头**: `Authorization: Bearer {token}`

**路径参数**:
- `id` (long): 标签ID

**响应数据**: 标签对象

### 创建标签

**接口**: `POST /admin/tags`

**请求头**: `Authorization: Bearer {token}`

**请求参数**:
```json
{
  "name": "标签名称",
  "color": "#007396"
}
```

**字段说明**:
- `name`: 标签名称（必需，最大30字符）
- `color`: 标签颜色（可选，十六进制颜色值）

**响应数据**: 创建的标签对象

### 更新标签

**接口**: `PUT /admin/tags/{id}`

**请求头**: `Authorization: Bearer {token}`

**路径参数**:
- `id` (long): 标签ID

**请求参数**: 同创建标签

**响应数据**: 更新后的标签对象

### 删除标签

**接口**: `DELETE /admin/tags/{id}`

**请求头**: `Authorization: Bearer {token}`

**路径参数**:
- `id` (long): 标签ID

**响应数据**: 无

## 作品集管理

### 获取所有作品集

**接口**: `GET /admin/portfolios`

**请求头**: `Authorization: Bearer {token}`

**响应数据**: 作品集列表

### 获取作品集详情

**接口**: `GET /admin/portfolios/{id}`

**请求头**: `Authorization: Bearer {token}`

**路径参数**:
- `id` (long): 作品集ID

**响应数据**: 作品集对象

### 创建作品集

**接口**: `POST /admin/portfolios`

**请求头**: `Authorization: Bearer {token}`

**请求参数**:
```json
{
  "name": "项目名称",
  "description": "项目描述",
  "url": "https://github.com/user/project",
  "coverImage": "http://example.com/cover.jpg",
  "technologies": "Java, Spring Boot, Vue.js",
  "sortOrder": 1,
  "isFeatured": true
}
```

**字段说明**:
- `name`: 项目名称（必需，最大100字符）
- `description`: 项目描述（可选）
- `url`: 项目链接（可选）
- `coverImage`: 封面图片URL（可选）
- `technologies`: 技术栈（可选，最大500字符）
- `sortOrder`: 排序顺序（可选，默认0）
- `isFeatured`: 是否精选（可选，默认false）

**响应数据**: 创建的作品集对象

### 更新作品集

**接口**: `PUT /admin/portfolios/{id}`

**请求头**: `Authorization: Bearer {token}`

**路径参数**:
- `id` (long): 作品集ID

**请求参数**: 同创建作品集

**响应数据**: 更新后的作品集对象

### 删除作品集

**接口**: `DELETE /admin/portfolios/{id}`

**请求头**: `Authorization: Bearer {token}`

**路径参数**:
- `id` (long): 作品集ID

**响应数据**: 无

## 友链管理

### 获取所有友链

**接口**: `GET /admin/friend-links`

**请求头**: `Authorization: Bearer {token}`

**响应数据**: 友链列表

### 获取友链详情

**接口**: `GET /admin/friend-links/{id}`

**请求头**: `Authorization: Bearer {token}`

**路径参数**:
- `id` (long): 友链ID

**响应数据**: 友链对象

### 创建友链

**接口**: `POST /admin/friend-links`

**请求头**: `Authorization: Bearer {token}`

**请求参数**:
```json
{
  "name": "友站名称",
  "url": "https://example.com",
  "avatar": "http://example.com/avatar.jpg",
  "description": "友站描述",
  "sortOrder": 1,
  "isActive": true
}
```

**字段说明**:
- `name`: 友站名称（必需，最大50字符）
- `url`: 友站链接（必需）
- `avatar`: 友站头像URL（可选）
- `description`: 友站描述（可选，最大200字符）
- `sortOrder`: 排序顺序（可选，默认0）
- `isActive`: 是否激活（可选，默认true）

**响应数据**: 创建的友链对象

### 更新友链

**接口**: `PUT /admin/friend-links/{id}`

**请求头**: `Authorization: Bearer {token}`

**路径参数**:
- `id` (long): 友链ID

**请求参数**: 同创建友链

**响应数据**: 更新后的友链对象

### 删除友链

**接口**: `DELETE /admin/friend-links/{id}`

**请求头**: `Authorization: Bearer {token}`

**路径参数**:
- `id` (long): 友链ID

**响应数据**: 无

## 邮箱订阅管理

### 获取所有订阅者

**接口**: `GET /admin/email-subscribers`

**请求头**: `Authorization: Bearer {token}`

**请求参数**:
- `page` (int, 可选): 页码，默认0
- `size` (int, 可选): 每页大小，默认10

**响应数据**: 分页的订阅者列表

### 删除订阅者

**接口**: `DELETE /admin/email-subscribers/{id}`

**请求头**: `Authorization: Bearer {token}`

**路径参数**:
- `id` (long): 订阅者ID

**响应数据**: 无

## 访问统计

### 获取访问统计

**接口**: `GET /admin/stats/visits`

**请求头**: `Authorization: Bearer {token}`

**响应数据**:
```json
{
  "totalVisits": 10000,
  "todayVisits": 100,
  "uniqueVisitors": 5000,
  "totalArticles": 50,
  "recentVisits": [
    {
      "date": "2024-01-01",
      "visits": 100
    }
  ],
  "popularPages": [
    {
      "uri": "/articles/1",
      "visits": 500
    }
  ]
}
```

## 错误处理

### 常见错误响应

**认证失败** (401):
```json
{
  "code": 401,
  "message": "未授权，请先登录",
  "data": null,
  "timestamp": 1691740800000
}
```

**权限不足** (403):
```json
{
  "code": 403,
  "message": "权限不足，需要管理员权限",
  "data": null,
  "timestamp": 1691740800000
}
```

**参数验证错误** (400):
```json
{
  "code": 400,
  "message": "参数验证失败",
  "data": {
    "field": "title",
    "message": "文章标题不能为空"
  },
  "timestamp": 1691740800000
}
```

**资源不存在** (404):
```json
{
  "code": 404,
  "message": "文章不存在",
  "data": null,
  "timestamp": 1691740800000
}
```

## 后台管理使用示例

### 登录API

```javascript
// api/auth.js
import axios from 'axios'

const authApi = axios.create({
  baseURL: 'http://localhost:8888/api',
  timeout: 10000
})

export const login = async (username, password) => {
  try {
    const response = await authApi.post('/auth/login', {
      username,
      password
    })

    if (response.data.code === 200) {
      // 保存token到localStorage
      localStorage.setItem('admin_token', response.data.data.token)
      return response.data
    } else {
      throw new Error(response.data.message || '登录失败')
    }
  } catch (error) {
    throw new Error(error.response?.data?.message || '网络错误')
  }
}

export const logout = () => {
  localStorage.removeItem('admin_token')
  window.location.href = '/admin/login'
}
```

### Axios 配置

```javascript
// api/config.js
import axios from 'axios'

// 创建axios实例
const api = axios.create({
  baseURL: 'http://localhost:8888/api',
  timeout: 10000
})

// 请求拦截器 - 添加token
api.interceptors.request.use(
  config => {
    const token = localStorage.getItem('admin_token')
    if (token) {
      config.headers.Authorization = `Bearer ${token}`
    }
    return config
  },
  error => {
    return Promise.reject(error)
  }
)

// 响应拦截器 - 统一处理错误
api.interceptors.response.use(
  response => {
    const { data } = response
    if (data.code === 200) {
      return data
    } else {
      throw new Error(data.message || '请求失败')
    }
  },
  error => {
    if (error.response?.status === 401) {
      // token过期，跳转到登录页
      localStorage.removeItem('admin_token')
      window.location.href = '/admin/login'
    } else if (error.response?.status === 403) {
      throw new Error('权限不足')
    } else {
      throw new Error(error.response?.data?.message || '网络错误')
    }
  }
)

export default api
```

### 登录组件示例

```javascript
// components/Login.jsx (React)
import React, { useState } from 'react'
import { login } from '../api/auth'

const Login = ({ onLoginSuccess }) => {
  const [form, setForm] = useState({
    username: '',
    password: ''
  })
  const [loading, setLoading] = useState(false)
  const [error, setError] = useState('')

  const handleSubmit = async (e) => {
    e.preventDefault()
    setLoading(true)
    setError('')

    try {
      const response = await login(form.username, form.password)
      alert('登录成功')
      onLoginSuccess?.(response.data)
    } catch (error) {
      setError(error.message)
    } finally {
      setLoading(false)
    }
  }

  return (
    <div className="login-form">
      <h2>管理员登录</h2>

      <form onSubmit={handleSubmit}>
        <div>
          <label>用户名:</label>
          <input
            type="text"
            value={form.username}
            onChange={(e) => setForm(prev => ({
              ...prev,
              username: e.target.value
            }))}
            required
          />
        </div>

        <div>
          <label>密码:</label>
          <input
            type="password"
            value={form.password}
            onChange={(e) => setForm(prev => ({
              ...prev,
              password: e.target.value
            }))}
            required
          />
        </div>

        {error && <div className="error">{error}</div>}

        <button type="submit" disabled={loading}>
          {loading ? '登录中...' : '登录'}
        </button>
      </form>
    </div>
  )
}

export default Login
```

### 文章管理API

```javascript
// api/article.js
import api from './config'

export const articleApi = {
    // 获取文章列表
    getList: (page = 0, size = 10) =>
        api.get(`/admin/articles?page=${page}&size=${size}`),

    // 获取文章详情
    getDetail: (id) =>
        api.get(`/admin/articles/${id}`),

    // 创建文章
    create: (data) =>
        api.post('/admin/articles', data),

    // 更新文章
    update: (id, data) =>
        api.put(`/admin/articles/${id}`, data),

    // 删除文章
    delete: (id) =>
        api.delete(`/admin/articles/${id}`),

    // 发布文章
    publish: (id) =>
        api.put(`/admin/articles/${id}/publish`),

    // 取消发布
    unpublish: (id) =>
        api.put(`/admin/articles/${id}/unpublish`)
}
```

### React 管理组件示例

```javascript
// components/ArticleManager.jsx
import React, { useState, useEffect } from 'react'
import { articleApi } from '../api/article'

const ArticleManager = () => {
    const [articles, setArticles] = useState([])
    const [loading, setLoading] = useState(false)
    const [pagination, setPagination] = useState({
        page: 0,
        size: 10,
        total: 0
    })

    // 获取文章列表
    const fetchArticles = async (page = 0) => {
        setLoading(true)
        try {
            const response = await articleApi.getList(page, pagination.size)
            setArticles(response.data.content)
            setPagination(prev => ({
                ...prev,
                page: response.data.page,
                total: response.data.totalElements
            }))
        } catch (error) {
            console.error('获取文章失败:', error)
            alert(error.message)
        } finally {
            setLoading(false)
        }
    }

    // 发布文章
    const handlePublish = async (id) => {
        try {
            await articleApi.publish(id)
            alert('文章发布成功')
            fetchArticles(pagination.page)
        } catch (error) {
            console.error('发布文章失败:', error)
            alert(error.message)
        }
    }

    // 删除文章
    const handleDelete = async (id) => {
        if (!confirm('确定要删除这篇文章吗？')) return

        try {
            await articleApi.delete(id)
            alert('文章删除成功')
            fetchArticles(pagination.page)
        } catch (error) {
            console.error('删除文章失败:', error)
            alert(error.message)
        }
    }

    useEffect(() => {
        fetchArticles()
    }, [])

    return (
        <div className="article-manager">
            <h2>文章管理</h2>

            {loading ? (
                <div>加载中...</div>
            ) : (
                <div>
                    <table>
                        <thead>
                            <tr>
                                <th>标题</th>
                                <th>状态</th>
                                <th>创建时间</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody>
                            {articles.map(article => (
                                <tr key={article.id}>
                                    <td>{article.title}</td>
                                    <td>{article.status}</td>
                                    <td>{new Date(article.createdAt).toLocaleDateString()}</td>
                                    <td>
                                        {article.status === 'DRAFT' && (
                                            <button onClick={() => handlePublish(article.id)}>
                                                发布
                                            </button>
                                        )}
                                        <button onClick={() => handleDelete(article.id)}>
                                            删除
                                        </button>
                                    </td>
                                </tr>
                            ))}
                        </tbody>
                    </table>

                    {/* 分页组件 */}
                    <div className="pagination">
                        <button
                            disabled={pagination.page === 0}
                            onClick={() => fetchArticles(pagination.page - 1)}
                        >
                            上一页
                        </button>
                        <span>第 {pagination.page + 1} 页</span>
                        <button
                            disabled={pagination.page >= Math.ceil(pagination.total / pagination.size) - 1}
                            onClick={() => fetchArticles(pagination.page + 1)}
                        >
                            下一页
                        </button>
                    </div>
                </div>
            )}
        </div>
    )
}

export default ArticleManager
```

### Vue 3 管理组件示例

```javascript
// components/ArticleManager.vue
<template>
    <div class="article-manager">
        <h2>文章管理</h2>

        <div v-if="loading">加载中...</div>

        <div v-else>
            <table>
                <thead>
                    <tr>
                        <th>标题</th>
                        <th>状态</th>
                        <th>创建时间</th>
                        <th>操作</th>
                    </tr>
                </thead>
                <tbody>
                    <tr v-for="article in articles" :key="article.id">
                    <td>{{ article.title }}</td>
                    <td>{{ article.status }}</td>
                    <td>{{ formatDate(article.createdAt) }}</td>
                    <td>
                        <button
                            v-if="article.status === 'DRAFT'"
                        @click="handlePublish(article.id)"
                        >
                        发布
                    </button>
                    <button @click="handleDelete(article.id)">
                    删除
                </button>
            </td>
        </tr>
    </tbody>
</table>

<!-- 分页 -->
<div class="pagination">
    <button
    :disabled="pagination.page === 0"
    @click="fetchArticles(pagination.page - 1)"
    >
    上一页
</button>
<span>第 {{ pagination.page + 1 }} 页</span>
<button 
          :disabled="pagination.page >= totalPages - 1"
@click="fetchArticles(pagination.page + 1)"
    >
    下一页
    </button>
</div>
</div>
</div>
</template>

<script setup>
    import { ref, reactive, computed, onMounted } from 'vue'
    import { articleApi } from '../api/article'

    const articles = ref([])
    const loading = ref(false)
    const pagination = reactive({
    page: 0,
    size: 10,
    total: 0
})

    const totalPages = computed(() =>
    Math.ceil(pagination.total / pagination.size)
    )

    // 获取文章列表
    const fetchArticles = async (page = 0) => {
    loading.value = true
    try {
    const response = await articleApi.getList(page, pagination.size)
    articles.value = response.data.content
    pagination.page = response.data.page
    pagination.total = response.data.totalElements
} catch (error) {
    console.error('获取文章失败:', error)
    ElMessage.error(error.message)
} finally {
    loading.value = false
}
}

    // 发布文章
    const handlePublish = async (id) => {
    try {
    await articleApi.publish(id)
    ElMessage.success('文章发布成功')
    fetchArticles(pagination.page)
} catch (error) {
    console.error('发布文章失败:', error)
    ElMessage.error(error.message)
}
}

    // 删除文章
    const handleDelete = async (id) => {
    try {
    await ElMessageBox.confirm('确定要删除这篇文章吗？', '提示')
    await articleApi.delete(id)
    ElMessage.success('文章删除成功')
    fetchArticles(pagination.page)
} catch (error) {
    if (error !== 'cancel') {
    console.error('删除文章失败:', error)
    ElMessage.error(error.message)
}
}
}

    // 格式化日期
    const formatDate = (dateString) => {
    return new Date(dateString).toLocaleDateString()
}

    onMounted(() => {
    fetchArticles()
})
</script>
```

## 注意事项

1. **Token管理**: JWT token有效期为24小时，过期后需要重新登录
2. **权限验证**: 所有接口都需要管理员权限，确保token有效
3. **数据验证**: 提交数据前进行前端验证，减少服务器压力
4. **错误处理**: 统一处理401和403错误，提供良好的用户体验
5. **分页处理**: 注意分页参数从0开始
6. **文件上传**: 如需要文件上传功能，请查看Swagger文档
7. **批量操作**: 目前不支持批量操作，需要逐个处理

## 在线文档

完整的API文档可以通过以下方式查看：

- **Swagger UI**: http://localhost:8888/api/swagger-ui.html
- **OpenAPI JSON**: http://localhost:8888/api/api-docs

建议在开发过程中结合Swagger UI进行接口测试和调试。
